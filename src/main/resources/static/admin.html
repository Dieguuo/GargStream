<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administraci√≥n - GargStream</title>
    <style>
        body { background-color: #141414; color: white; font-family: Arial, sans-serif; margin: 0; display: flex; height: 100vh;}

        /* BARRA LATERAL */
        .sidebar { width: 250px; background-color: #000; padding: 20px; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .sidebar h2 { color: #e50914; margin-bottom: 30px; }
        .menu-btn {
            background: none; border: none; color: #aaa;
            text-align: left; padding: 15px; cursor: pointer;
            font-size: 1.1em; transition: 0.3s; width: 100%;
            border-radius: 5px; margin-bottom: 5px;
        }
        .menu-btn:hover, .menu-btn.active { background-color: #333; color: white; }
        .back-link { margin-top: auto; color: #aaa; text-decoration: none; padding: 10px; }
        .back-link:hover { color: white; }

        /* AREA DE CONTENIDO (Dividida en formulario y consola) */
        .content { flex: 1; padding: 40px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px;}

        /* FORMULARIOS */
        .form-section { display: none; max-width: 600px; }
        .form-section.active { display: block; animation: fadeIn 0.5s; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        label { display: block; margin-top: 15px; color: #ccc; }
        input[type="text"], input[type="number"], textarea, input[type="file"] {
            width: 100%; padding: 10px; margin-top: 5px;
            background-color: #333; border: 1px solid #444; color: white; border-radius: 4px;
        }
        button[type="submit"] {
            background-color: #e50914; color: white; border: none;
            padding: 12px 20px; margin-top: 20px; cursor: pointer;
            font-size: 1em; font-weight: bold; border-radius: 4px; width: 100%;
        }
        button[type="submit"]:hover { background-color: #f40612; }
        .nota { font-size: 0.8em; color: #777; margin-top: 5px; }

        /* --- NUEVO: CONSOLA DE RESULTADOS --- */
        #console-box {
            background-color: #0d0d0d;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            color: #0f0; /* Verde Hacker */
            min-height: 150px;
            max-height: 300px;
            overflow: auto;
            white-space: pre-wrap; /* Mantiene el formato del JSON */
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            display: none; /* Oculto hasta que haya respuesta */
        }
        .console-title { color: #555; font-size: 0.8em; margin-bottom: 5px; text-transform: uppercase;}
    </style>
</head>
<body>

<div class="sidebar">
    <h2>‚öôÔ∏è Admin Panel</h2>
    <button class="menu-btn active" onclick="mostrar('sec-cine')">üé¨ Nueva Pel√≠cula</button>
    <button class="menu-btn" onclick="mostrar('sec-serie')">üì∫ Nueva Serie</button>
    <button class="menu-btn" onclick="mostrar('sec-capitulo')">‚ñ∂Ô∏è Nuevo Cap√≠tulo</button>
    <button class="menu-btn" onclick="mostrar('sec-video')">üìπ Video Personal</button>

    <a href="index.html" class="back-link">‚Üê Volver al Cat√°logo</a>
</div>

<div class="content">

    <div id="console-box">
        <div class="console-title">Server Response:</div>
        <div id="console-content">Esperando acci√≥n...</div>
    </div>

    <div id="sec-cine" class="form-section active">
        <h1>Subir Pel√≠cula</h1>
        <form action="/api/admin/nueva-pelicula" onsubmit="enviarFormulario(event)">
            <label>T√≠tulo de la Pel√≠cula:</label>
            <input type="text" name="titulo" required placeholder="Ej: El Padrino">
            <label>Archivo de V√≠deo:</label>
            <input type="file" name="archivo" required accept="video/*">
            <button type="submit">Subir Pel√≠cula</button>
        </form>
    </div>

    <div id="sec-serie" class="form-section">
        <h1>Crear Nueva Serie</h1>
        <form action="/api/admin/nueva-serie" onsubmit="enviarFormulario(event)">
            <label>Nombre de la Serie:</label>
            <input type="text" name="titulo" required placeholder="Ej: Breaking Bad">
            <button type="submit">Crear Ficha de Serie</button>
        </form>
    </div>

    <div id="sec-capitulo" class="form-section">
        <h1>Subir Cap√≠tulo</h1>
        <form action="/api/admin/nuevo-capitulo" onsubmit="enviarFormulario(event)">
            <label>ID de la Serie:</label>
            <input type="number" name="idSerie" required placeholder="Ej: 1">
            <label>N√∫mero de Temporada:</label>
            <input type="number" name="numTemporada" required value="1">
            <label>N√∫mero de Cap√≠tulo:</label>
            <input type="number" name="numCapitulo" required value="1">
            <label>T√≠tulo del Cap√≠tulo:</label>
            <input type="text" name="titulo" placeholder="Ej: Piloto">
            <label>Archivo de V√≠deo:</label>
            <input type="file" name="archivo" required accept="video/*">
            <button type="submit">Subir Cap√≠tulo</button>
        </form>
    </div>

    <div id="sec-video" class="form-section">
        <h1>Subir Video Personal</h1>
        <form action="/api/admin/nuevo-video" onsubmit="enviarFormulario(event)">
            <label>T√≠tulo:</label>
            <input type="text" name="titulo" required>
            <label>Autor:</label>
            <input type="text" name="autor" placeholder="Yo">
            <label>Descripci√≥n:</label>
            <textarea name="descripcion" rows="3"></textarea>
            <label>Archivo:</label>
            <input type="file" name="archivo" required accept="video/*">
            <button type="submit">Subir Video</button>
        </form>
    </div>

</div>

<script>
    // 1. GESTI√ìN DE PESTA√ëAS
    function mostrar(idSeccion) {
        document.querySelectorAll('.form-section').forEach(div => div.classList.remove('active'));
        document.querySelectorAll('.menu-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(idSeccion).classList.add('active');

        // Ocultar consola al cambiar de pesta√±a para limpiar la vista
        document.getElementById('console-box').style.display = 'none';

        // Activar bot√≥n men√∫ (l√≥gica simple)
        const botones = document.querySelectorAll('.menu-btn');
        if(idSeccion === 'sec-cine') botones[0].classList.add('active');
        if(idSeccion === 'sec-serie') botones[1].classList.add('active');
        if(idSeccion === 'sec-capitulo') botones[2].classList.add('active');
        if(idSeccion === 'sec-video') botones[3].classList.add('active');
    }

    // 2. ENV√çO INTELIGENTE (AJAX)
    async function enviarFormulario(event) {
        // DETENER el env√≠o normal (para que no recargue la p√°gina)
        event.preventDefault();

        const form = event.target;
        const consola = document.getElementById('console-box');
        const contenidoConsola = document.getElementById('console-content');
        const boton = form.querySelector('button[type="submit"]');

        // Mostrar consola en estado "Cargando"
        consola.style.display = 'block';
        contenidoConsola.textContent = "‚è≥ Subiendo archivo y procesando... (Esto puede tardar unos segundos)";
        contenidoConsola.style.color = "#ffff00"; // Amarillo
        boton.disabled = true;
        boton.style.opacity = "0.5";

        try {
            // Preparar los datos
            const formData = new FormData(form);

            // Enviar al servidor
            const response = await fetch(form.action, {
                method: 'POST',
                body: formData
            });

            // Analizar respuesta
            const contentType = response.headers.get("content-type");

            if (contentType && contentType.indexOf("application/json") !== -1) {
                // SI ES JSON (√âXITO)
                const json = await response.json();
                contenidoConsola.textContent = JSON.stringify(json, null, 4); // Formatear bonito
                contenidoConsola.style.color = "#0f0"; // Verde
                form.reset(); // Limpiar formulario si sali√≥ bien
            } else {
                // SI NO ES JSON (ERROR HTML)
                // (Esto pasar√° si salta la excepci√≥n de archivo inv√°lido y devuelve la p√°gina de error)
                const texto = await response.text();

                // Truco: Intentamos sacar el mensaje de error del HTML si es nuestra p√°gina de error
                if(texto.includes("‚ö†Ô∏è Ups! Algo sali√≥ mal")) {
                     // Mostramos un mensaje gen√©rico, o parseamos el HTML si queremos ser muy finos
                     contenidoConsola.textContent = "‚ùå Error: Archivo inv√°lido o problema en el servidor.\n(Mira la consola del navegador para ver el HTML devuelto)";
                } else {
                    contenidoConsola.textContent = "Respuesta no JSON recibida:\n" + texto.substring(0, 200) + "...";
                }
                contenidoConsola.style.color = "#ff4444"; // Rojo
            }

        } catch (error) {
            console.error(error);
            contenidoConsola.textContent = "‚ùå Error de conexi√≥n: " + error.message;
            contenidoConsola.style.color = "#ff4444";
        } finally {
            boton.disabled = false;
            boton.style.opacity = "1";
        }
    }
</script>
</body>
</html>