<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>GargStream - Inicio</title>
  <style>
    body {
        background-color: #141414; /* Negro Netflix */
        color: white;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
    }
    h1 { color: #e50914; /* Rojo Netflix */ }

    .grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* Rejilla automática */
        gap: 20px;
        padding: 20px;
    }

    .card {
        background-color: #2f2f2f;
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.3s;
        cursor: pointer;
    }

    .card:hover {
        transform: scale(1.05); /* Efecto zoom al pasar el ratón */
    }

    .card img {
        width: 100%;
        height: 300px;
        object-fit: cover; /* Ajusta la imagen sin deformarla */
    }

    .info {
        padding: 10px;
    }

    .titulo {
        font-weight: bold;
        font-size: 1.1em;
        margin-bottom: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .tipo {
        font-size: 0.8em;
        color: #aaa;
        text-transform: uppercase;
        margin-bottom: 5px;
    }

    .btn-accion {
        display: block;
        text-align: center;
        color: white;
        text-decoration: none;
        background: #e50914;
        padding: 8px;
        border-radius: 4px;
        margin-top: 10px;
        font-weight: bold;
        transition: background 0.2s;
    }
    .btn-accion:hover {
        background: #f40612;
    }

    .btn-delete {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2em;
        opacity: 0; /* Invisible por defecto */
        transition: opacity 0.3s;
        z-index: 10;
    }

    .card:hover .btn-delete {
        opacity: 1; /* Visible al pasar el ratón */
    }

    .btn-delete:hover {
        background-color: red;
    }

    /* Necesario para posicionar el botón absoluto */
    .card {
        position: relative;
        /* ... el resto de estilos que ya tenías en .card ... */
    }
  </style>
</head>
<body>

<h1>GargStream</h1>
<p>Tu catálogo privado</p>

<div class="grid-container" id="catalogo">
</div>

<script>
  // Al cargar la página, pedimos los datos a la API
  fetch('/api/public/catalogo')
      .then(response => response.json())
      .then(contenidos => {
          const contenedor = document.getElementById('catalogo');

          contenidos.forEach(contenido => {
              const card = document.createElement('div');
              card.className = 'card';

              // 1. IMAGEN: Si no tiene, ponemos una gris
              const imagen = contenido.rutaCaratula ? contenido.rutaCaratula : 'https://via.placeholder.com/200x300?text=Sin+Imagen';

              // 2. LÓGICA INTELIGENTE: ¿Es Peli, Serie o Vídeo?
              let tipo = "Video Personal";
              let link = contenido.rutaVideo; // Por defecto asumimos que es un archivo
              let textoBoton = "Ver Ahora";
              let target = '_blank'; // Los vídeos se abren en pestaña nueva

              // SI NO TIENE RUTA DE VIDEO -> ES UNA SERIE (Contenedor)
              if (!contenido.rutaVideo) {
                  tipo = "Serie TV";
                  // Cambiamos el link para ir a la página de detalles
                  link = `/ver_serie.html?id=${contenido.id}`;
                  textoBoton = "Ver Capítulos";
                  target = '_self'; // Las series se abren en la misma pestaña (navegación)
              }
              // SI TIENE DIRECTOR -> ES UNA PELÍCULA
              else if (contenido.director) {
                  tipo = "Película";
              }

             // 3. PINTAR LA TARJETA
              card.innerHTML = `
                  <button class="btn-delete" onclick="borrarContenido(${contenido.id}, this)" title="Borrar">
                      &times;
                  </button>

                  <img src="${imagen}" alt="${contenido.titulo}">
                  <div class="info">
                      <div class="titulo" title="${contenido.titulo}">${contenido.titulo}</div>
                      <div class="tipo">${tipo}</div>
                      <div style="font-size:0.9em; color: #ffd700;">⭐ ${contenido.puntuacionMedia || '-'}</div>

                      <a href="${link}" target="${target}" class="btn-accion">
                          ${textoBoton}
                      </a>
                  </div>
              `;

              contenedor.appendChild(card);
          });
      })
      .catch(error => console.error('Error cargando catálogo:', error));

  function borrarContenido(id, boton) {
            // Preguntar para no borrar por error
            if(!confirm("¿Seguro que quieres borrar esto? Si es una serie, se borrarán todos sus capítulos.")) {
                return;
            }

            // Llamada al backend
            fetch('/api/admin/eliminar/' + id, {
                method: 'DELETE'
            })
            .then(response => {
                if(response.ok) {
                    // Si se borró bien, quitamos la tarjeta de la pantalla visualmente
                    // El truco: 'boton' es la X, su padre es la 'card'
                    const tarjeta = boton.parentElement;
                    tarjeta.style.transition = "transform 0.5s, opacity 0.5s";
                    tarjeta.style.transform = "scale(0)";
                    tarjeta.style.opacity = "0";

                    setTimeout(() => tarjeta.remove(), 500); // Esperar a la animación y borrar
                } else {
                    alert("Error al borrar.");
                }
            })
            .catch(error => console.error(error));
        }
</script>

</body>
</html>